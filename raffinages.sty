% raffinages.sty - Package LaTeX pour raffinages
% Auteur : Mazen Messai
% Description : Package pour la rédaction de raffinages structurés

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{raffinages}[2025/05/06 v1.0 Package pour les raffinages]
\RequirePackage{xparse}
\RequirePackage[x11names]{xcolor}
\RequirePackage{etoolbox}
\RequirePackage{tabularx}
\RequirePackage{lineno}

% --- Commentaires ---
\newcommand{\commentaire}[1]{%
  \par
  \noindent
  \leftskip=1em
  \begin{minipage}{\dimexpr\linewidth - \leftskip\relax}
    \textcolor{blue}{-{}- \texttt{#1}}\par
  \end{minipage}
}


% --- Raffinage principal ---
\NewDocumentEnvironment{raffinage}{mm}
{
  \begin{linenumbers}
  \par\noindent\texttt{R#1 : #2}\par
  \begingroup
  \leftskip=1em
}
{
  \noindent\par
  \endgroup
  \end{linenumbers}
  \leftskip=0em
  \par\rule{0pt}{0pt}\par
}

% --- Étapes (action + [flux]) ---
\NewDocumentCommand{\step}{m o}{%
  \noindent
  \begin{minipage}{\dimexpr\linewidth - \leftskip\relax}  % Forcer la largeur à \linewidth
    \begin{tabularx}{\linewidth}{@{\hskip\leftskip}X r}
      \texttt{#1} & \IfValueT{#2}{\texttt{#2}}%
    \end{tabularx}%
  \end{minipage}%
  \par
}

% --- Environnement à indentation automatique ---
\newenvironment{ifstructure}[1]
{
    \leftskip=1em
    \par\noindent\texttt{\textcolor{DeepPink1}{Si} #1 \textcolor{DeepPink1}{alors} :}\par
    \begingroup\leftskip=2em
}
{
    \leftskip=1em
    \par\noindent\texttt{Fin \textcolor{DeepPink1}{Si}}\par
    \endgroup
}

\newenvironment{whilestructure}[1]
{
  \leftskip=1em
  \par\noindent\texttt{\textcolor{DeepPink1}{Tant que} #1 \textcolor{DeepPink1}{faire} :}\par
  \begingroup\leftskip=2em
}
{
  \leftskip=1em
  \noindent\texttt{Fin \textcolor{DeepPink1}{Tant que}}\par
  \endgroup
}

\newenvironment{forstructure}[1]
{
  \leftskip=1em
  \par\noindent\texttt{\textcolor{DeepPink1}{Pour} #1 \textcolor{DeepPink1}{faire} :}\par
  \begingroup\leftskip=2em
}
{
  \leftskip=1em
  \noindent\texttt{Fin \textcolor{DeepPink1}{Pour}}\par
  \endgroup
}


